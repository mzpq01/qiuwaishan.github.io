
<html>
<head>
    <title>RiyadhGo</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <!-- read data from json file -->
    <script src="data/json/some/fsq_checkin.json"></script>
    <script src="data/json/some/all_nodes.json"></script>
    <script src="data/json/some/riyadh_traffic.json"></script>    
    <!-- read data from json file -->
<!--     <script src="data/json/446.json"></script>
    <script src="data/json/746.json"></script>
    <script src="data/json/1062.json"></script>
    <script src="data/json/1274.json"></script> -->


    <link href="css/main.css" rel="stylesheet" />
    <style>
        body {
            position: absolute;
            font-family: "Proxima Nova", "Montserrat", sans-serif;
        }
        h1, h2, h3, h4, h5, span {
            position: absolute;
            left: 10px;
            font-size: 0.6em;
            font-weight: 100;
        }
        h1 {
            font-size: 2.4em;
        }

        h2 {
            top: 50px;
            font-size: 1.4em;
        }
        h3 {
            position: absolute;
            top: 80px;
            font-size: 1.4em;
        }
        h4 {
            position: absolute;
            top: 160px;                      
            font-size: 1em;
        }
        h5 {
            position: absolute;
            top: 220px;                      
            font-size: 1em;
        }
        .hover {
            fill: yellow;
            stroke: "#feaa37";
            stroke-width: 1;   
        }
        #sliderContainer {
            text-align: absolute;
            position: absolute;
            top: 200px;
        }
        #sliderContainer2 {
            text-align: absolute;
            position: absolute;
            top: 260px;
        }   
    </style>
</head>

<body>
    <h1> RIYADH GO </h1>
    <h2> CLICK to explore your travel cost from Riyadh Hotspopts </h2>
    <h3> </h3> 
    <h4> TIME OF DAY </h4> 
    <h5> TYPE OF COST </h4> 
    <div id="sliderContainer"> <!-- a slider -->
        <input id="timeslide" type="range" min="0" max="3" value="0" step="1"/><br>
        <span id="range">Morning</span>
    </div>
    <div id="sliderContainer2"> <!-- a slider -->
        <input id="timeslide2" type="range" min="0" max="2" value="0" step="1"/><br>
        <span id="range2">Money</span>
    </div>
    <button id="Time" style="position: absolute; margin-left: 6px; margin-top: 6px;">Time</button>
    <button id="Money" style="position: absolute; margin-left: 150px; margin-top: 6px">Distance</button>
    <button id="Distance" style="position: absolute; margin-left: 150px; margin-top: 6px">Money</button>

    <script>
    // console.log(all_json);
    var width = 900;
    var height = 1600;

    var inputValue2 = null

    var albersProjection = d3.geo.albers()
        .scale( 100000 )
        .rotate( [-46.731,0] )
        .center( [0, 24.580] )
        .translate( [width/2,height/2] );
 
    var geoPath = d3.geo.path()
        .projection( albersProjection );


    var inputValue = null
    var timeofday = ["Morning","Midday","Evening","Rest of Day"]
    var inputValue2 = null
    var typeofcost = ["Money","Time","Distance"]

    var color_roads = d3.scale.linear()
        .domain([0, 0.5, 4])
        .range(["#dadaeb", "#bcbddc","#9e9ac8"]);

    var color_gradient = d3.scale.linear()
        .domain([4, 20, 36])
        .range(['#88d8b0', '#ffcc5c','#ff6f69']);

    var color_checkin = d3.scale.threshold()
        .domain([10, 1000, 10000, 30000, 60000, 95000])
        .range(["#f2f0f7", "#dadaeb", "#bcbddc", "#9e9ac8", "#756bb1", "#54278f"]);

    var color_checkin_warm = d3.scale.threshold()
        .domain([10, 1000, 10000, 30000, 95000])
        .range(["#dc6900", "#eb8c00 ", "#e0301e", "#a32020", "#602320"]);

    var color_time = d3.scale.threshold()
        .domain([0, 5, 10, 20, 30])
        .range(["#a8e6cf", "#dcedc1", "#ffd3b6", "#ffaaa5", "#ff8b94"]);

    var color_dist = d3.scale.threshold()
        .domain([0, 1, 5, 10, 20])
        .range(["#83d0c9", "#65c3ba", "#54b2a9", "#35a79c", "#009688"]);

    var color_money = d3.scale.threshold()
        .domain([1, 5, 10, 15, 20])
        .range(["#96ceb4", "88d8b0", "ffeead", "ffcc5c", "ff6f69"]);

    var svg = d3.select( "body" )
        .append( "svg" )
        .attr('class', 'road_network')
        .attr( "width", width )
        .attr( "height", height );

    // Slider#1 when the input range changes update the value 
    d3.select("#timeslide").on("input", function() {
        create_RiyadhVoc(+this.value);
    });
    // update the fill of each SVG of class "incident"
    function create_RiyadhVoc(value) {
        document.getElementById("range").innerHTML=timeofday[value];
        inputValue = timeofday[value];
        d3.select(".RiyadhVoc").remove();
        var city_network = svg.append( "g" )
            .attr('class', 'RiyadhVoc');
        city_network.selectAll( "path" )
            .data( traffic_json.features )
            .enter()
            .append( "path" )
            .attr("stroke", "white")
            .attr("fill", "none")
            .attr("stroke-width",0)
            .transition()
            .duration(3000)
            .attr("stroke", function (x) {
                if (inputValue =="Morning"){
                    return color_roads(x.properties.voc_am)
                } else if (inputValue == "Midday"){
                    return color_roads(x.properties.voc_md)
                } else if (inputValue == "Evening"){
                    return color_roads(x.properties.voc_pm)
                } else {
                    return color_roads(x.properties.voc_rd)
                }
            })
            .attr("stroke-width", function (x) {
                if (inputValue =="Morning"){
                    return x.properties.voc_am *1.2+0.1
                } else if (inputValue == "Midday"){
                    return x.properties.voc_md *1.2+0.1
                } else if (inputValue == "Evening"){
                    return x.properties.voc_pm *1.2+0.1
                } else {
                    return x.properties.voc_rd *1.2+0.1
                }
            })
            .attr( "d", geoPath ) // "d" is D3.attribute stands for coordinates of a path
            .attr("class","incident");
    }
    var check_in = svg.append( "g" )
        .attr('class','FSQ_checkin');
    check_in.selectAll( "path" )
        .data( checkin.features )
        .enter()
        .append( "path" )
        .attr( "stroke", "#d7b936" )
        .attr( "d", geoPath )
        .attr("class","incident")
        .attr("opacity", 0.9)
        .attr("stroke-width", function(x) {return (x.properties.checkin*0.00005+0.05);})
        .attr("fill", function(x) { return color_checkin(x.properties.checkin);})
        .on("mouseover", function(d){
            tooltip.style("visibility", "visible").text(d.properties.category+" | CHECKINs: " +d.properties.checkin);
            d3.select(this).attr("class","incident hover");
        })
        .on("mousemove", function(d){
            tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px").text(d.properties.category+" | CHECKINs: " +d.properties.checkin);
            d3.select(this).attr("class","incident hover");
        })
        .on("mouseout", function(d){
            tooltip.style("visibility", "hidden");
            d3.select(this).attr("class","incident");
        })   
        .on('click', function(x) {
            var node_id = x.properties.closest_node;
            d3.select(".Shortest_Path").remove();
            create_shortpath(node_id);
        });
    //Define the tootip which realize hover show text function
    var tooltip = d3.select("body")
        .append("div")
        .style("position", "absolute")
        .style("font-family", "'Open Sans', sans-serif")
        .style("font-size", "16px")
        .style("z-index", "10")
        .style("visibility", "hidden");

    function create_shortpath(node_id) {
        // console.log(all_json[node_id])
        // Slider#2 when the input range changes update the value 
        var read_data = null
        d3.select("#timeslide2").on("input", function() {
            update_slider2(+this.value);
        });
        function update_slider2(value) {
            document.getElementById("range2").innerHTML=typeofcost[value];
            inputValue2 = typeofcost[value];
        }
        current_paths = svg.append( "g" )
            .attr('class','Shortest_Path'); //"id" can be change to whatever for example "class", but if it is not "id", it cannot be selected by d3.select().romove
        if (inputValue2 == "Distance") {
            current_paths.selectAll(".incident2")
                .data(all_json[node_id].features)  
                .enter()
                .append( "path" )
                .attr("stroke", "white")
                .attr("fill", "none")
                .attr("stroke-width",0.1)
                .on("mouseover", function(x){
                    d3.select("h3").text("Distance Travel to Here: "+x.properties.sum_dist+" KM");
                    d3.select(this).attr("class","incident2 hover");
                })
                .on("mouseout", function(d){
                    d3.select("h3").text("");
                    d3.select(this).attr("class","incident2")
                })
                .transition()
                .duration(2000)
                .attr( "fill", "#900" )
                .attr( "d", geoPath ) 
                .attr("class","incident2")
                .attr("stroke", function(d) { return color_dist(d.properties.sum_dist);})
                .attr("stroke-width", function(x) {return (x.properties.sum_dist*0.2);});

        } else if (inputValue2 == "Time") {
            current_paths.selectAll(".incident2")
                .data(all_json[node_id].features)  
                .enter()
                .append( "path" )
                .attr("stroke", "white")
                .attr("fill", "none")
                .attr("stroke-width",0.1)
                .on("mouseover", function(x){
                    d3.select("h3").text("Time Cost to Here by Taxi: "+x.properties.sum_time+" minutes");
                    d3.select(this).attr("class","incident2 hover");
                })
                .on("mouseout", function(d){
                    d3.select("h3").text("");
                    d3.select(this).attr("class","incident2")
                })
                .transition()
                .duration(2000)
                .attr( "fill", "#900" )
                .attr( "d", geoPath ) 
                .attr("class","incident")
                .attr("stroke", function(d) { return color_time(d.properties.sum_time);})
                .attr("stroke-width", function(x) {return (x.properties.sum_time*0.2);})
; 
        } else {
            current_paths.selectAll(".incident2")
                .data(all_json[node_id].features)  
                .enter()
                .append( "path" )
                .attr("stroke", "white")
                .attr("fill", "none")
                .attr("stroke-width",0)
                .on("mouseover", function(d){
                    d3.select("h3").text("Cost to Here by Uber: "+Math.round((4+0.35*d.properties.sum_time+1.05*d.properties.sum_dist)*100)/100+"SAD");
                    tooltip.style("visibility", "visible").text("Distance(KM): " +d.properties.sum_dist+"   "+"Time(Minutes) "+d.properties.sum_time);
                })
                .on("mousemove", function(d){
                    tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px").text("Distance(KM):" +d.properties.sum_dist+" | "+"Time(Minutes)"+d.properties.sum_time);
                })
                .on("mouseout", function(d){
                    d3.select("h3").text("");
                    tooltip.style("visibility","hidden");
                })
                .transition()
                .duration(2000)
                .attr( "fill", "#900" )
                .attr( "d", geoPath ) 
                .attr("class","incident2")
                .attr("stroke", function(d) { return color_gradient(4+0.35*d.properties.sum_time+1.05*d.properties.sum_dist);})
                .attr("stroke-width", function(x) {return ((4+0.35*x.properties.sum_time+1.05*x.properties.sum_dist)*0.15+0.05);});
        // Create SVG for Tooltip on Mouseover
        var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("font-family", "'Open Sans', sans-serif")
            .style("font-size", "12px")
            .style("z-index", "10")
            .style("visibility", "hidden");

        }

    }
   
    </script>
</body>
</html>